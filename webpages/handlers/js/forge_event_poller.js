// Generated by CoffeeScript 1.6.3
(function() {
  var fOnLoad;

  fOnLoad = function() {
    var editor, fChangeCrosses;
    document.title = 'Forge Event Poller';
    $('#pagetitle').text('Forge your custom event poller!');
    editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/coffee");
    editor.setShowPrintMargin(false);
    $('#editor_mode').change(function(el) {
      if ($(this).val() === '0') {
        return editor.getSession().setMode("ace/mode/coffee");
      } else {
        return editor.getSession().setMode("ace/mode/javascript");
      }
    });
    $('#but_submit').click(function() {
      var data, err;
      try {
        data = JSON.parse(editor.getValue());
        return $.post('/event', data).done(function(data) {
          return alert(data);
        }).fail(function(err) {
          return alert('Posting of event failed: ' + err.responseText);
        });
      } catch (_error) {
        err = _error;
        return alert('You have errors in your JSON object!');
      }
    });
    fChangeCrosses = function() {
      return $('#listParams img').each(function(id) {
        var par;
        par = $(this).parent('tr');
        if (par.is(':last-child' || par.is(':only-child'))) {
          return $(this).hide();
        } else {
          return $(this).show();
        }
      });
    };
    $('#listParams').on('click', 'img', function() {
      var par;
      par = $(this).parent('tr');
      if (!par.is(':last-child')) {
        par.remove();
      }
      return fChangeCrosses();
    });
    $('#listParams').on('keyup', 'input', function() {
      var td, tr;
      console.log('weees');
      if ($(this).parent('tr').is(':last-child')) {
        tr = $('<tr>');
        td = tr.append('td');
        td.append($('<img>').attr('src', 'red_cross_small.png'));
        td.append($('<input>').attr('type', 'text'));
        $('#listParams').append(tr);
        return fChangeCrosses();
      }
    });
    return fChangeCrosses();
  };

  window.addEventListener('load', fOnLoad, true);

}).call(this);
